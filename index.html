<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ›å¥æ¨‚ç²¾æº–è¨ˆé‡æ¸¬é©— - é€²éšæ•¸å­¸ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ç­”å°ä¸”é¸ä¸­ï¼šç¶ è‰² */
        .correct-opt {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #166534 !important;
            font-weight: 600;
        }
        /* æ­£è§£ä½†æ¼é¸ï¼šé»ƒè‰² */
        .missing-opt {
            background-color: #fef9c3 !important;
            border-color: #eab308 !important;
            color: #854d0e !important;
            font-weight: 600;
        }
        /* é¸éŒ¯ï¼šç´…è‰² */
        .wrong-opt {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #991b1b !important;
        }
        .option-label {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen py-8 px-4">
    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- æ¨™é¡Œæ¬„ -->
        <div class="bg-amber-600 p-8 text-white text-center">
            <h1 class="text-3xl font-bold">ğŸ§® çŒ›å¥æ¨‚ç²¾æº–è¨ˆé‡æ¸¬é©—</h1>
            <p class="mt-2 text-amber-100 opacity-90">é€²éšæŒ‘æˆ°ï¼šæ··åˆåŠ‘é‡ã€æ®˜åŠ‘èˆ‡è½‰æ¬¡æ›ç®—</p>
        </div>

        <div class="p-6 md:p-10">
            <div id="loading" class="text-center py-20 text-slate-500">
                <div class="animate-spin inline-block w-10 h-10 border-4 border-amber-500 border-t-transparent rounded-full mb-4"></div>
                <p class="text-lg">æ­£åœ¨è®€å–é€²éšé¡Œåº«...</p>
            </div>

            <div id="result-area" class="hidden mb-10 p-8 bg-amber-50 rounded-2xl text-center border-2 border-amber-100 shadow-inner">
                <div class="text-6xl font-black text-amber-600 mb-2" id="final-score">0</div>
                <div class="text-xl font-bold text-amber-800" id="score-comment"></div>
            </div>

            <div id="quiz-flow" class="space-y-10"></div>

            <div class="mt-12 flex flex-col sm:flex-row gap-4">
                <button id="submit-btn" onclick="checkAnswers()" class="hidden w-full py-5 bg-amber-600 hover:bg-amber-700 text-white font-bold text-lg rounded-xl shadow-lg transition-all active:scale-95">
                    æäº¤æ¸¬é©—ä¸¦æŸ¥çœ‹è©³è§£
                </button>
                <button id="restart-btn" onclick="startTest()" class="hidden w-full py-5 bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-lg rounded-xl shadow-lg transition-all active:scale-95">
                    é‡æ–°æŠ½å– 10 é¡Œ
                </button>
            </div>
        </div>
    </div>

    <script>
        let database = [];
        let currentTest = [];

        async function init() {
            try {
                const res = await fetch('math_quiz.json');
                if (!res.ok) throw new Error('æ‰¾ä¸åˆ° math_quiz.json æª”æ¡ˆ');
                database = await res.json();
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('submit-btn').classList.remove('hidden');
                startTest();
            } catch (e) {
                document.getElementById('loading').innerHTML = `
                    <div class="text-red-500 p-6 bg-red-50 rounded-xl">
                        <p class="text-xl font-bold">âŒ è¼‰å…¥å¤±æ•—</p>
                        <p class="mt-2 text-sm">${e.message}</p>
                    </div>`;
            }
        }

        function startTest() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('restart-btn').classList.add('hidden');
            
            const shuffled = [...database].sort(() => 0.5 - Math.random());
            currentTest = shuffled.slice(0, 10);
            renderQuestions();
        }

        function renderQuestions() {
            const flow = document.getElementById('quiz-flow');
            flow.innerHTML = '';
            
            currentTest.forEach((q, i) => {
                const card = document.createElement('div');
                card.className = "bg-white border border-slate-200 rounded-2xl p-6 md:p-8 shadow-sm";
                
                card.innerHTML = `
                    <div class="flex items-center gap-4 mb-6">
                        <span class="text-3xl font-black text-slate-300">#${i+1}</span>
                        <span class="px-5 py-2 bg-amber-100 text-amber-700 border-2 border-amber-200 text-base font-black rounded-xl shadow-sm uppercase">
                            ğŸ§® è¨ˆç®—æŒ‘æˆ°
                        </span>
                    </div>
                    <div class="text-xl font-bold text-slate-800 mb-8 leading-relaxed">${q.q}</div>
                    <div class="space-y-4" id="opt-container-${i}"></div>
                    <div id="exp-${i}" class="hidden mt-8 p-6 bg-amber-50 border-l-8 border-amber-400 rounded-r-2xl">
                        <div class="text-emerald-700 font-bold text-lg mb-3" id="correct-text-${i}"></div>
                        <div class="text-slate-700 leading-relaxed"><strong class="text-amber-700">ã€è¨ˆç®—è©³è§£ã€‘</strong><br>${q.rationale.replace(/\n/g, '<br>')}</div>
                    </div>
                `;
                
                const optBox = card.querySelector(`#opt-container-${i}`);
                q.options.forEach((opt, idx) => {
                    const label = document.createElement('label');
                    label.className = "option-label flex items-center p-4 border-2 border-slate-100 rounded-xl cursor-pointer hover:bg-slate-50 hover:border-amber-200 group";
                    label.innerHTML = `
                        <input type="radio" name="q${i}" value="${idx}" class="w-6 h-6 text-amber-600 border-slate-300 focus:ring-amber-500">
                        <span class="ml-4 text-slate-700 font-medium text-lg">${opt}</span>
                    `;
                    optBox.appendChild(label);
                });
                flow.appendChild(card);
            });
        }

        function checkAnswers() {
            let score = 0;
            currentTest.forEach((q, i) => {
                const inputs = document.querySelectorAll(`input[name="q${i}"]`);
                const checkedIdx = Array.from(inputs).find(input => input.checked);
                const userVal = checkedIdx ? parseInt(checkedIdx.value) : -1;
                
                // --- é—œéµä¿®å¾©ï¼šç›¸å®¹ æ•¸å­— 1 æˆ– é™£åˆ— [1] çš„æ ¼å¼ ---
                const correctIndices = Array.isArray(q.answer) ? q.answer : [q.answer];
                const isCorrect = correctIndices.includes(userVal);
                
                if (isCorrect) score++;

                inputs.forEach((input, idx) => {
                    const label = input.parentElement;
                    const isRightAnswer = correctIndices.includes(idx);
                    const isUserChecked = input.checked;

                    // é‡ç½®æ¨£å¼
                    label.classList.remove('correct-opt', 'missing-opt', 'wrong-opt');

                    if (isRightAnswer && isUserChecked) {
                        label.classList.add('correct-opt');
                        label.innerHTML += '<span class="ml-auto font-bold text-xl">âœ…</span>';
                    } else if (isRightAnswer && !isUserChecked) {
                        label.classList.add('missing-opt');
                        label.innerHTML += '<span class="ml-auto font-bold text-xl">âš ï¸</span>';
                    } else if (!isRightAnswer && isUserChecked) {
                        label.classList.add('wrong-opt');
                        label.innerHTML += '<span class="ml-auto font-bold text-xl">âŒ</span>';
                    }
                    input.disabled = true;
                });

                // æ›´æ–°è©³è§£å€çš„æ­£ç¢ºç­”æ¡ˆæ–‡å­—
                const correctTextNames = correctIndices.map(idx => q.options[idx]).join('ã€');
                document.getElementById(`correct-text-${i}`).innerText = `æ­£ç¢ºç­”æ¡ˆï¼š${correctTextNames}`;
                document.getElementById(`exp-${i}`).classList.remove('hidden');
            });

            document.getElementById('final-score').innerText = `${score * 10} / 100`;
            document.getElementById('score-comment').innerText = score >= 8 ? "é€™è¨ˆç®—é‡é›£ä¸å€’ä½ ï¼å¤ªå¼·äº†ï¼" : "æœ‰äº›ç´°ç¯€æ²’æ³¨æ„åˆ°ï¼Œçœ‹çœ‹è©³è§£æœ‰åŠ©æ–¼ç†æ¸…é‚è¼¯ã€‚";
            
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('restart-btn').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        init();
    </script>
</body>
</html>

