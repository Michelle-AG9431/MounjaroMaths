<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒ›å¥æ¨‚ç²¾æº–è¨ˆé‡æ¸¬é©—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct-opt { background-color: #dcfce7 !important; border-color: #22c55e !important; color: #166534 !important; font-weight: 600; }
        .missing-opt { background-color: #fef9c3 !important; border-color: #eab308 !important; color: #854d0e !important; font-weight: 600; }
        .wrong-opt { background-color: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b !important; }
        .option-label { transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen py-8 px-4">
    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- æ¨™é¡Œæ¬„ -->
        <div class="bg-amber-600 p-8 text-white text-center">
            <h1 class="text-3xl font-bold">ğŸ§® çŒ›å¥æ¨‚ç²¾æº–è¨ˆé‡æ¸¬é©—</h1>
            <p class="mt-2 text-amber-100 opacity-90">å°ˆç‚ºè¨ˆç®—æ„›å¥½è€…è¨­è¨ˆï¼šéš¨æ©ŸæŠ½è€ƒ 10 é¡Œè¨ˆç®—é¡Œ</p>
        </div>

        <div class="p-6 md:p-10">
            <!-- è¼‰å…¥ä¸­ç‹€æ…‹ -->
            <div id="loading" class="text-center py-20 text-slate-500">
                <div class="animate-spin inline-block w-10 h-10 border-4 border-amber-500 border-t-transparent rounded-full mb-4"></div>
                <p class="text-lg">æ­£åœ¨è®€å–è¨ˆé‡é¡Œåº«...</p>
            </div>

            <!-- åˆ†æ•¸é¡¯ç¤ºå€ -->
            <div id="result-area" class="hidden mb-10 p-8 bg-amber-50 rounded-2xl text-center border-2 border-amber-100 shadow-inner">
                <div class="text-6xl font-black text-amber-600 mb-2" id="final-score">0</div>
                <div class="text-xl font-bold text-amber-800" id="score-comment"></div>
            </div>

            <!-- é¡Œç›®æµ -->
            <div id="quiz-flow" class="space-y-10"></div>

            <!-- æ§åˆ¶æŒ‰éˆ• -->
            <div class="mt-12 flex flex-col sm:flex-row gap-4">
                <button id="submit-btn" onclick="checkAnswers()" class="hidden w-full py-5 bg-amber-600 hover:bg-amber-700 text-white font-bold text-lg rounded-xl shadow-lg transition-all active:scale-95">
                    æäº¤æ¸¬é©—ä¸¦æŸ¥çœ‹è©³è§£
                </button>
                <button id="restart-btn" onclick="startTest()" class="hidden w-full py-5 bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-lg rounded-xl shadow-lg transition-all active:scale-95">
                    é‡æ–°æŠ½å–é¡Œç›®
                </button>
            </div>
        </div>
    </div>

    <script>
        let database = [];
        let currentTest = [];

        async function init() {
            try {
                // å¾ math_quiz.json è®€å–å–®é¸è¨ˆç®—é¡Œ
                const res = await fetch('math_quiz.json');
                if (!res.ok) throw new Error('æ‰¾ä¸åˆ° math_quiz.json æª”æ¡ˆ');
                database = await res.json();
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('submit-btn').classList.remove('hidden');
                startTest();
            } catch (e) {
                document.getElementById('loading').innerHTML = `
                    <div class="text-red-500 p-6 bg-red-50 rounded-xl">
                        <p class="text-xl font-bold">âŒ è¼‰å…¥å¤±æ•—</p>
                        <p class="mt-2 text-sm">${e.message}</p>
                        <p class="mt-4 text-slate-500">è«‹ç¢ºèª math_quiz.json æª”æ¡ˆèˆ‡æ­¤ç¶²é æ”¾åœ¨åŒä¸€å€‹è·¯å¾‘ã€‚</p>
                    </div>`;
            }
        }

        function startTest() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('restart-btn').classList.add('hidden');
            
            // ç›´æ¥å¾å…¨éƒ¨é¡Œç›®ä¸­éš¨æ©ŸæŠ½å‡º 10 é¡Œ
            const shuffled = [...database].sort(() => 0.5 - Math.random());
            currentTest = shuffled.slice(0, 10);
            
            renderQuestions();
        }

        function renderQuestions() {
            const flow = document.getElementById('quiz-flow');
            flow.innerHTML = '';
            
            currentTest.forEach((q, i) => {
                const card = document.createElement('div');
                card.className = "bg-white border border-slate-200 rounded-2xl p-6 md:p-8 shadow-sm transition-all";
                
                card.innerHTML = `
                    <div class="flex items-center gap-4 mb-6">
                        <span class="text-2xl font-black text-slate-300">#${i+1}</span>
                        <span class="px-4 py-1.5 bg-amber-100 text-amber-700 border-amber-200 text-sm font-black rounded-lg border-2 shadow-sm uppercase tracking-wide">
                            ğŸ§® ç²¾æº–è¨ˆé‡
                        </span>
                    </div>
                    <div class="text-xl font-bold text-slate-800 mb-8 leading-relaxed">${q.q}</div>
                    <div class="space-y-4" id="opt-container-${i}"></div>
                    <div id="exp-${i}" class="hidden mt-8 p-6 bg-amber-50 border-l-8 border-amber-400 rounded-r-2xl">
                        <div class="text-emerald-700 font-bold text-lg mb-3">æ­£ç¢ºç­”æ¡ˆï¼š${q.options[q.answer]}</div>
                        <div class="text-slate-700 leading-relaxed"><strong class="text-amber-700">ã€è¨ˆç®—è©³è§£ã€‘</strong><br>${q.rationale.replace(/\n/g, '<br>')}</div>
                    </div>
                `;
                
                const optBox = card.querySelector(`#opt-container-${i}`);
                q.options.forEach((opt, idx) => {
                    const label = document.createElement('label');
                    label.className = "option-label flex items-center p-4 border-2 border-slate-100 rounded-xl cursor-pointer hover:bg-slate-50 hover:border-amber-200 group";
                    label.innerHTML = `
                        <input type="radio" name="q${i}" value="${idx}" class="w-6 h-6 text-amber-600 border-slate-300 focus:ring-amber-500 rounded-full">
                        <span class="ml-4 text-slate-700 font-medium text-lg">${opt}</span>
                    `;
                    optBox.appendChild(label);
                });
                
                flow.appendChild(card);
            });
        }

        function checkAnswers() {
            let score = 0;
            currentTest.forEach((q, i) => {
                const inputs = document.querySelectorAll(`input[name="q${i}"]`);
                const checkedIdx = Array.from(inputs).find(input => input.checked);
                const userVal = checkedIdx ? parseInt(checkedIdx.value) : -1;
                
                const isCorrect = userVal === q.answer;
                if (isCorrect) score++;

                inputs.forEach((input, idx) => {
                    const label = input.parentElement;
                    const isRightAnswer = idx === q.answer;
                    const isUserChecked = input.checked;

                    if (isRightAnswer && isUserChecked) {
                        label.classList.add('correct-opt');
                        label.innerHTML += '<span class="ml-auto font-bold text-xl">âœ…</span>';
                    } else if (isRightAnswer && !isUserChecked) {
                        label.classList.add('missing-opt');
                        label.innerHTML += '<span class="ml-auto font-bold text-xl">âš ï¸</span>';
                    } else if (!isRightAnswer && isUserChecked) {
                        label.classList.add('wrong-opt');
                        label.innerHTML += '<span class="ml-auto font-bold text-xl">âŒ</span>';
                    }
                    input.disabled = true;
                });

                document.getElementById(`exp-${i}`).classList.remove('hidden');
            });

            document.getElementById('final-score').innerText = `${score * 10} / 100`;
            document.getElementById('score-comment').innerText = score >= 8 ? "è¨ˆç®—å¤§å¸«ï¼æ‚¨çš„é‚è¼¯éå¸¸åš´å¯†ï¼" : "æ•¸å­¸æ˜¯éœ€è¦ç·´ç¿’çš„ï¼Œå»ºè­°å¤šçœ‹çœ‹è¨ˆç®—è©³è§£ã€‚";
            
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('restart-btn').classList.remove('hidden');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        init();
    </script>
</body>
</html>